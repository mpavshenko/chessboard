"use strict";function board(e,t){function n(e,t,n){var i=$('<div class="cell"></div>').width(v).height(v);return i.append($('<div data-type="'+q.type+'" data-color="'+q.color+'" class="piece"/>').width(v).height(v).css("background-image",e)),i}function i(){N&&N.removeClass("clicked"),N=null}function a(){D=M,$("#arrow-btn").css("background-color","white"),$("#arrow-btn").css("box-shadow","inset 0 0 0 "+v/10+"px "+g),$("#arrow-btn").css("color",g),$("."+m+" .cell, ."+m+" .piece").addClass("cursor-pointer")}function r(){D=null,j=null,$("#arrow-btn").css("background-color",""),$("#arrow-btn").css("box-shadow","none"),$("#arrow-btn").css("color","white"),$("."+m+" .cell, ."+m+" .piece").removeClass("cursor-pointer")}function o(e,t,n,i){d.remove(e),d.put({type:t,color:n},i)}function s(){for(var e=0;e<d.SQUARES.length;e++){var t=d.SQUARES[e],n=d.get(t);n&&$("#"+t).append($('<div data-type="'+n.type+'" data-color="'+n.color+'" id="'+t+'" class="piece"></div>').width(v).height(v).css("background-image","url(img/pieces/"+n.type+n.color+".svg)"))}}function c(){$(".btn-main").height(v).width(v).css("font-size",v/2).css("line-height",v+"px")}function l(){var e=$("body").hasClass("hide-sidedrawer")?0:$("#sidedrawer").width();$(window).width()-e-$("#board-container").outerWidth(!0)-Math.min($("#pieces-panel").outerWidth(!0),$("#pieces-panel").outerHeight(!0))>0?($("#pieces-panel .cell").css("float","none"),$("#pieces-panel .pieces-panel-row").css("float","left")):($("#pieces-panel .cell").css("float","left"),$("#pieces-panel .pieces-panel-row").css("float","none"))}var d=new Chess;d.reset();var p=$(e),h=$(t),u=window.innerWidth,w=window.innerHeight-$("#header").height(),g="#2780E3",v=Math.floor((Math.min(u,w)-40)/8.6),f=.3*v,b=8*v+4,k=b+2*f;p.width(k).height(k);for(var m="gameField",P=$('<div class="'+m+'"/>').height(b).width(b),y=[],K=0;K<d.SQUARES.length;K++){var Q=d.SQUARES[K],x=d.square_color(Q),q=d.get(Q),C=$('<div id="'+Q+'" class="cell"></div>').width(v).height(v);P.append(C.addClass(x)),q&&C.append($('<div data-type="'+q.type+'" data-color="'+q.color+'" class="piece"></div>').width(v).height(v).css("background-image","url(img/pieces/"+q.type+q.color+".svg)")),y.push(C[0])}for(var A=$("<div>").css("margin-left",f+"px"),S=["A","B","C","D","E","F","G","H"],K=0;K<8;K++){var R=$('<div class="alphabetLetter">'+S[K]+"</div>").width(v).height(f).css("line-height",f+"px").css("font-size",.2*v+"px");A.append(R)}for(var T=$('<div class="numericLetterPanel"/>').width(f),K=8;K>0;K--){var B=$('<div class="numericLetter">'+K+"</div>").css("line-height",v+"px").css("font-size",.2*v+"px");T.append(B)}p.append(A),p.append($("<div/>").append(T).append(P).append(T.clone())),p.append(A.clone());for(var E=["b","w"],z=["r","n","b","k","q","p"],U=$("<div/>"),W=[],K=0;K<E.length;K++){for(var F=$('<div class="pieces-panel-row"/>'),L=0;L<z.length;L++){C=n("url(img/pieces/"+z[L]+E[K]+".svg)");F.append(C),W.push(C[0])}if(0==K){C=n("url(img/pieces/custom/duck.svg)");F.append(C),W.push(C[0]),C=n("url(img/pieces/custom/owl.svg)"),F.append(C),W.push(C[0])}else{C=n("url(img/pieces/custom/bomb.svg)");F.append(C),W.push(C[0]),C=n("url(img/pieces/custom/rocket.svg)"),F.append(C),W.push(C[0])}U.append(F)}U.append('<div class="clearfix"/>'),h.append(U).css("padding",f+"px");var N=null,D=null,M="ARROW_DRAW_MODE",O=$cArrows("."+m),j=null;$(".cell").on("click",function(e){if(e.stopPropagation(),D==M)if($(this).parents("."+m).length>0)if(j){var t=$(this).attr("id");j!=t&&(O.arrow("#"+j,"#"+$(this).attr("id"),{arrow:{connectionType:"center"},render:{strokeStyle:"white",lineWidth:v/7}}),O.arrow("#"+j,"#"+$(this).attr("id"),{arrow:{connectionType:"center"},render:{strokeStyle:g,lineWidth:v/8}})),j=null}else j=$(this).attr("id");else r();else{var n=$(this);N?(0==n.parents("#pieces-panel").length?(N.is(n)||n.empty(),N.parents("#pieces-panel").length>0?$(N.children()[0]).clone().prependTo(n):$(N.children()[0]).detach().prependTo(n)):0==N.parents("#pieces-panel").length&&N.empty(),0!=N.parents("#pieces-panel").length&&0!=n.parents(".gameField").length||i()):n.children().length>0&&(N=n,n.addClass("clicked"))}}),$(window).on("click",function(e){N&&(0==N.parents("#pieces-panel").length&&N.empty(),i()),r()});var H=dragula(y.concat(W),{revertOnSpill:!0,removeOnSpill:!0,accepts:function(e,t,n,i){return!($(t).parents("#pieces-panel").length>0)&&(setTimeout(function(){$(".gu-transit",t).prependTo(t)}),!0)},copy:function(e){return $(e).parents("#pieces-panel").length>0}});H.on("drag",function(e,t){r(),N&&i()}),H.on("drop",function(e,t,n,i){var a=$(t).attr("id"),r=$(n).attr("id");o(a,$(e).attr("data-type"),$(e).attr("data-color"),r),$(t).children().not(":first").remove()}),$(window).resize(function(){l(),c()}),$(document).ready(function(){l(),c()});var _={};return _.clear=function(){d.clear(),$(".piece",e).remove()},_.initial=function(){_.clear(),d.reset(),s()},_.getPosition=function(){alert(d.fen())},_.setPosition=function(e){_.clear(),d.reset(),d.load(e),s()},_.setPositionFromUser=function(){var e=prompt("Введите позиции в формате FEN","rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");e&&_.setPosition(e)},_.createArrow=function(e){i(),a(),e.stopPropagation()},_.clearArrowLayout=function(){O.CanvasStorage[2]=[],O.redraw()},_.sizePx=k,_}function setSavedPosition(e){board.setPosition(savedPositions[e])}var board=board("#board-container","#pieces-panel");$("#load-fen-btn-header").click(board.setPositionFromUser),$("#save-fen-btn-header").click(board.getPosition),$("#clear-btn, #clear-btn-header").click(board.clear),$("#initial-btn, #initial-btn-header").click(board.initial),$("#arrow-btn, #arrow-btn-header").click(board.createArrow),$("#arrows-delete-btn, #arrows-delete-btn-header").click(board.clearArrowLayout),$("#download-image-btn, #download-image-btn-header").click(function(e){html2canvas($("#board-container"),{onrendered:function(e){var t=e.getContext("2d");t.globalAlpha=.2,t.textAlign="center";var n=board.sizePx/8;t.font=n+"px Arial",t.shadowColor="black",t.shadowBlur=1,t.textBaseline="alphabetic",t.scale(1,1),t.fillStyle="white",t.fillText("chess-board.ru",e.width/2,e.height/2+n/4),document.body.appendChild(e);var i=document.createElement("a"),a=e.toDataURL("image/png");a=a.replace("image/png","image/octet-stream"),document.body.removeChild(e),i.download="board.png",i.href=a,i.click()},width:board.sizePx,height:board.sizePx})});var savedPositions={"1-1":"3k4/3p4/8/3KB3/8/p7/P7/5b2 w KQkq - 0 1","1-2":"8/6k1/6p1/3K4/5B2/8/8/8 w KQkq - 0 1","1-3":"2r5/8/2p1k3/2P5/8/5B2/5K2/8 w KQkq - 0 1","1-4":"7k/8/1p6/1P6/1Q1K4/8/8/8 w KQkq - 0 1","1-5":"2r4k/8/5p2/5P2/6K1/8/1Q5P/8 w KQkq - 0 1","1-6":"8/3b1k2/3p4/8/2N5/2P5/2K5/8 w KQkq - 0 1","1-7":"8/8/2pk4/8/2PP4/3K4/8/8 w KQkq - 0 1","2-1":"6k1/8/3R2K1/8/8/8/8/8 w KQkq - 0 1","2-2":"7k/8/6K1/8/8/8/5R2/8 w KQkq - 0 1","2-3":"8/8/8/5K2/7k/8/8/3Q4 w KQkq - 0 1","2-4":"8/6Q1/8/8/2K5/8/k7/2B5 w KQkq - 0 1","2-5":"1Q6/8/8/7N/2K5/7k/8/8 w KQkq - 0 1","2-6":"7k/2p2R2/3p4/3K4/8/1p6/1P6/1Q6 w KQkq - 0 1"};jQuery(function(e){var t=e("body"),n=e("#sidedrawer");e(".js-show-sidedrawer").on("click",function(){var t={onclose:function(){n.removeClass("active").appendTo(document.body)}},i=e(mui.overlay("on",t));n.appendTo(i),setTimeout(function(){n.addClass("active")},20)}),e(".js-hide-sidedrawer").on("click",function(){t.toggleClass("hide-sidedrawer")});var i=e("strong",n);i.next().hide(),i.on("click",function(){var t=e(this).next();t.is(":visible")?t.hide():t.show()})});
//# sourceMappingURL=app.js.map
