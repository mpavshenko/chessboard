!function(e){function t(t){for(var o,i,s=t[0],c=t[1],l=t[2],p=0,h=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(d&&d(t);h.length;)h.shift()();return n.push.apply(n,l||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],o=!0,s=1;s<a.length;s++){var c=a[s];0!==r[c]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var o={},r={1:0},n=[];function i(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(e){var t=[],a=r[e];if(0!==a)if(a)t.push(a[2]);else{var o=new Promise((function(t,o){a=r[e]=[t,o]}));t.push(a[2]=o);var n,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(e){return i.p+"js/"+({0:"alr"}[e]||e)+"."+{0:"3c76a8588bef88a573ac",3:"725cbe457efa45e74302"}[e]+".js"}(e);var c=new Error;n=function(t){s.onerror=s.onload=null,clearTimeout(l);var a=r[e];if(0!==a){if(a){var o=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+o+": "+n+")",c.name="ChunkLoadError",c.type=o,c.request=n,a[1](c)}r[e]=void 0}};var l=setTimeout((function(){n({type:"timeout",target:s})}),12e4);s.onerror=s.onload=n,document.head.appendChild(s)}return Promise.all(t)},i.m=e,i.c=o,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;n.push([7,2]),a()}({10:function(e,t,a){var o=a(1),r=a(11);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var n={insert:"head",singleton:!1},i=(o(r,n),r.locals?r.locals:{});e.exports=i},11:function(e,t,a){(t=a(2)(!1)).push([e.i,".canvas{width:calc(10vmin * 8 + calc(10vmin * 0.4) * 2 + 4px);height:calc(10vmin * 8 + calc(10vmin * 0.4) * 2 + 4px);position:absolute;pointer-events:none}.board-container{display:flex;align-items:flex-start}@media all and (orientation: portrait){.board-container{flex-direction:column;align-items:center}}.proxy{position:relative}.chess-board{background-color:#657188;font-size:2vmin;display:flex column}.chess-board .game-field{float:left;border:2px solid #dbdbdd}.chess-board .game-field .cell{width:10vmin;height:10vmin}.chess-board .game-field .arrow-mode{cursor:n-resize}.chess-board .game-field .light{background:#dbdbdd}.chess-board .game-field .light:hover{transition:all 0.5s;background-color:#b4b4b8}.chess-board .game-field .light:active{transition:all 0.1s;background-color:#a7a7ab}.chess-board .game-field .dark{background:#657188}.chess-board .game-field .dark:hover{transition:all 0.1s;background-color:#444d5c}.chess-board .game-field .dark:active{transition:all 0.1s;background-color:#3a404d}.chess-board .numeric-letters-panel .numeric-letter{text-align:center;color:#dbdbdd;line-height:10vmin;height:10vmin;width:calc(10vmin * 0.4)}.chess-board .alphabet-letters-panel{display:flex;justify-content:center;align-items:center;height:calc(10vmin * 0.4)}.chess-board .alphabet-letters-panel .alphabet-letter{text-align:center;vertical-align:middle;color:#dbdbdd;width:10vmin}.cursor-pointer{cursor:pointer}.piece{width:10vmin;height:10vmin;cursor:grab;cursor:-webkit-grab;cursor:-moz-grab;background-repeat:no-repeat;background-position:center center;background-size:95%}.piece:hover{background-size:110%}.pieces-box{padding:calc(10vmin * 0.4);border:2px solid #657188;background-color:#f5f5f6;display:flex;flex-direction:row}@media all and (orientation: portrait){.pieces-box{flex-direction:column}}.pieces-box .pieces-box-row{display:flex}@media all and (orientation: landscape){.pieces-box .pieces-box-row{flex-direction:column}}.gu-mirror{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.cell div:nth-child(2){display:none}.light .selected-piece{background-size:114%;background-color:#a7a7ab}.light .selected-cell{background-color:#a7a7ab}.dark .selected-piece{background-size:110%;background-color:#3a404d}.dark .selected-cell{background-color:#a7a7ab}.pieces-box .selected-piece{background-size:110%;background-color:#a7a7ab;border-radius:10px}\n",""]),e.exports=t},25:function(e,t){var a;(a=CanvasRenderingContext2D)&&a.prototype&&(a.prototype.arrow=function(e,t,a,o,r){var n=a-e,i=o-t,s=Math.sqrt(n*n+i*i),c=i/s,l=n/s,d=[];d.push(0,0);for(var p=0;p<r.length;p+=2){var h=r[p],u=r[p+1];d.push(h<0?s+h:h,u)}for(d.push(s,0),p=r.length;p>0;p-=2)h=r[p-2],u=r[p-1],d.push(h<0?s+h:h,-u);for(d.push(0,0),p=0;p<d.length;p+=2)h=d[p]*l-d[p+1]*c+e,u=d[p]*c+d[p+1]*l+t,0===p?this.moveTo(h,u):this.lineTo(h,u)})},4:function(e,t,a){"use strict";(function(e){a(10);var o=a(5),r=a.n(o),n=(a(12),a(6)),i=a.n(n);a(25);const s=["a","b","c","d","e","f","g","h"],c=["b","w"],l=["r","n","b","k","q","p"],d=t=>e("<div>",{class:t});t.a=class{constructor(e){this.customs={},this.arrows=[],this.chess=new r.a,this.arrowMode=!1,this.load(window.location.hash),this.build(e),window.onhashchange=()=>{this.saveFlag?this.saveFlag=!1:(this.load(window.location.hash),this.putPeaces())}}build(t){const a=e(t).addClass("board-container"),o=d("proxy"),r=e("<canvas>",{class:"canvas"}),n=this.buildChessBoard();o.append(r),o.append(n),a.append(o),a.append(this.buildPiecesBox()),this.ctx=e(".canvas")[0].getContext("2d");const i=()=>{this.ctx.canvas.width=n.width(),this.ctx.canvas.height=n.height(),this.boardSize=n.width()};i(),window.onresize=()=>{i(),this.arrows.forEach(e=>this.drawArrow(e.from,e.to))},this.setupDragula(),this.setupClicks(),this.putPeaces()}buildChessBoard(){const t=d("chess-board"),a=this.buildGameField(),o=this.buildAlphabetLetterPanel(),r=this.buildNumericLetterPanel();return t.append(o),t.append(e("<div/>").css("display","flex").append(r).append(a).append(r.clone())),t.append(o.clone()),t}buildGameField(){const t=d("game-field");for(var a=8;a>0;a--){const o=e("<div>").css("display","flex");for(const t of s){const r=t+a,n=this.chess.square_color(r),i=e("<div>",{id:r,class:"cell "+n});o.append(i)}t.append(o)}return t}buildNumericLetterPanel(){const e=d("numeric-letters-panel");for(var t=8;t>0;t--){var a=d("numeric-letter").text(t);e.append(a)}return e}buildAlphabetLetterPanel(){const e=d("alphabet-letters-panel");for(const t of s){const a=d("alphabet-letter").text(t.toUpperCase());e.append(a)}return e}buildPiecesBox(){const e=d("pieces-box");function t(e,t){const a=d("cell box"),o=d("piece").attr("data-type",e).attr("data-color",t).css("background-image",`url(img/pieces/${e}${t}.svg)`);return a.append(o),a}var a=1;for(const o of c){const r=d("pieces-box-row");l.forEach(e=>r.append(t(e,o))),r.append(t(a++,"x")),r.append(t(a++,"x")),e.append(r)}return e}setupDragula(){const t=i()(e(".cell").toArray(),{revertOnSpill:!0,removeOnSpill:!0,accepts:(t,a)=>!e(a).hasClass("box")&&(setTimeout(()=>e(".gu-transit",a).prependTo(a)),!0),copy:(t,a)=>e(a).hasClass("box")});t.on("drag",(e,t)=>{this.deselectPiece()}),t.on("remove",(t,a,o)=>{const r=e(o).attr("id");this.chess.remove(r),delete this.customs[r],this.save()}),t.on("drop",(t,a,o)=>{const r=e(a).attr("id"),n=e(o).attr("id"),i=e(t).data();this.movePiece(n,r,i),e(a).children().not(".gu-transit").remove()})}movePiece(e,t,{type:a,color:o}){"x"==o?delete this.customs[e]:this.chess.remove(e),this.putPiece(t,{type:a,color:o})}putPiece(e,{type:t,color:a}){delete this.customs[e],"x"==a?(this.chess.remove(e),this.customs[e]={type:t,color:a}):this.chess.put({type:t,color:a},e),this.save()}save(){const e=this.chess.fen().replace(/\//g,"~").replace(/ /g,"_");const t=Object.entries(this.customs).map(([e,t])=>({id:e,...t})).filter(e=>e.type).map(e=>e.id+e.type+e.color).join(""),a=this.arrows.map(e=>e.from+e.to).join("");this.saveFlag=!0,window.location.hash=e+"#"+t+"#"+a}load(e){const[t,a,o]=e.slice(1).split("#");if(t){const e=t.replace(/~/g,"/").replace(/_/g," ");this.chess.load(e)}else this.chess.reset();this.customs=a?a.match(/.{1,4}/g).reduce((e,t)=>{const a=t.slice(0,2),o=t[2],r=t[3];return e[a]={type:o,color:r},e},{}):{},this.arrows=o?o.match(/.{1,4}/g).map(e=>({from:e.slice(0,2),to:e.slice(2,4)})):[]}deselectPiece(){this.selectedPiece&&(this.selectedPiece.removeClass("selected-piece"),this.selectedPiece=null,this.selectedCellId=null,e(".cell").css("cursor","default"),e(".piece").css("cursor","grab"))}cellToXY(t){const a=e(".cell").width(),o=e(".numeric-letter").width(),r=o+a*(8.5-parseInt(t[1]));return[o+a*(.5+s.indexOf(t[0])),r]}drawArrow(e,t){var[a,o]=this.cellToXY(e),[r,n]=this.cellToXY(t);const i=Math.sqrt((a-r)**2+(o-n)**2),s=this.boardSize/40,c=Math.abs(s*(a-r)/i),l=Math.abs(s*(o-n)/i);a>r?(a-=1.5*c,r+=c):(a+=1.5*c,r-=c),o>n?(o-=1.5*l,n+=l):(o+=1.5*l,n-=l),this.ctx.beginPath(),this.ctx.fillStyle="#ADC8D2",this.ctx.strokeStyle="#2b2d42",this.ctx.lineWidth=this.boardSize/350;const d=this.boardSize/140;this.ctx.arrow(a,o,r,n,[0,d,3*-d,d,3*-d,3*d]),this.ctx.fill(),this.ctx.stroke()}setupClicks(){const t=this;e(".cell").on("click",(function(a){a.stopPropagation();const o=e(this),r=o.children(".piece"),n=o.attr("id");if(!n){return t.cancelDrawMode(),void((t.selectedPiece&&t.selectedPiece.data().type+t.selectedPiece.data().color)!=r.data().type+r.data().color?(t.deselectPiece(),t.selectedCellId=n,t.selectedPiece=r,e(".cell").css("cursor","pointer"),e(".piece").css("cursor","pointer"),t.selectedPiece.addClass("selected-piece")):t.deselectPiece())}t.arrowMode?t.selectedCellId?(t.drawArrow(t.selectedCellId,n),t.arrows.push({from:t.selectedCellId,to:n}),t.save(),t.selectedCellId=null):t.selectedCellId=n:t.selectedPiece?t.selectedCellId!==n?(o.empty(),t.selectedCellId?(t.selectedPiece.detach().prependTo(o),t.movePiece(t.selectedCellId,n,t.selectedPiece.data()),t.deselectPiece()):(t.selectedPiece.clone().removeClass("selected-piece").prependTo(o),t.putPiece(n,t.selectedPiece.data()))):t.deselectPiece():r.length&&(t.selectedCellId=n,t.selectedPiece=r,e(".cell").css("cursor","pointer"),e(".piece").css("cursor","pointer"),t.selectedPiece.addClass("selected-piece"))}))}putPeaces(){function t({id:t,type:a,color:o}){const r=e("#"+t),n=d("piece").data({type:a,color:o}).css("background-image",`url(img/pieces/${a}${o}.svg)`);r.append(n)}e(".game-field .cell").empty(),this.chess.SQUARES.map(e=>({id:e,...this.chess.get(e)})).filter(e=>e.type).forEach(t),Object.entries(this.customs).map(([e,t])=>({id:e,...t})).forEach(t),this.eraseArrowsFromCanvas(),this.arrows.forEach(e=>this.drawArrow(e.from,e.to))}eraseArrowsFromCanvas(){this.ctx.clearRect(0,0,this.boardSize,this.boardSize)}setInitialPosition(){this.chess.reset(),this.customs={},this.arrows=[],this.putPeaces()}toggleDrawMode(){this.arrowMode?this.cancelDrawMode():this.setDrawMode()}setDrawMode(){this.arrowMode=!0,this.deselectPiece(),e(".game-field .cell").addClass("arrow-mode"),this.onSetDrawMode&&this.onSetDrawMode()}cancelDrawMode(){this.arrowMode=!1,e(".game-field .cell").removeClass("arrow-mode"),this.onCancelDrawMode&&this.onCancelDrawMode()}removeArrows(){this.arrows=[],this.eraseArrowsFromCanvas(),this.save(),this.cancelDrawMode()}}}).call(this,a(3))},7:function(e,t,a){"use strict";a.r(t),function(e){a(8);var t=a(4);function o(){window.location.hash&&window.history.back()}function r(){const e=document.createElement("input"),t=window.location.href;document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),s(e=>e.message("Ссылка скопирована в буфер обмена"))}e(document).ready((function(){const a=new t.a("#board-container"),n=e("#draw-arrows");a.onCancelDrawMode=()=>n.removeClass("select"),a.onSetDrawMode=()=>n.addClass("select"),e("#copy-url").click(r),e("#download-image").click(i),e("#go-back").click(o),n.click(()=>a.toggleDrawMode()),e("#remove-arrows").click(()=>a.removeArrows()),e("#donate").click(e=>{e.preventDefault(),s(e=>e.alert("Спасибо за поддержку!",'\n<iframe \n  src="https://money.yandex.ru/quickpay/shop-widget?writer=seller&targets=%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B0%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0&targets-hint=&default-sum=300&button-text=13&payment-type-choice=on&mobile-payment-type-choice=on&hint=&successURL=&quickpay=shop&account=410015717303956" \n  width="100%" \n  height="222" \n  frameborder="0" \n  allowtransparency="true" \n  scrolling="no">\n</iframe>\n'))}),e(".se-pre-con").fadeOut("fast")}));var n=1;async function i(){const{default:e}=await a.e(3).then(a.t.bind(null,26,7)),t=await e(document.querySelector(".proxy"));document.body.appendChild(t);var o=document.createElement("a"),r=t.toDataURL("image/png");r=r.replace("image/png","image/octet-stream"),document.body.removeChild(t),o.download=`chess-board-${n++}.png`,o.href=r,o.click()}async function s(e){await a.e(0).then(a.t.bind(null,27,7));const{default:t}=await a.e(0).then(a.t.bind(null,28,7));e(t)}}.call(this,a(3))},8:function(e,t,a){var o=a(1),r=a(9);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var n={insert:"head",singleton:!1},i=(o(r,n),r.locals?r.locals:{});e.exports=i},9:function(e,t,a){(t=a(2)(!1)).push([e.i,'body{margin:0;padding:0;font-family:"Segoe UI", "Source Sans Pro", Calibri, Candara, Arial, sans-serif}.navbar{width:100%;height:70px;background-color:#2b2d42;box-shadow:0px 1px 10px 1px gray;display:flex;align-items:center;justify-content:space-between;color:#dbdbdd}@media (max-height: 800px) and (orientation: landscape){.navbar{display:none}}.navbar h1{display:flex;align-items:center;margin-left:calc(10vmin * 0.2);font-size:1.5em;font-weight:400}.navbar h1 i{font-size:1.7em;width:10vmin;text-align:center}@media all and (orientation: portrait){.navbar h1 i{display:none}}.navbar h1 #big-header{margin-left:calc(10vmin * 0.2)}@media all and (orientation: portrait){.navbar h1 #big-header{display:none}}.navbar h1 #small-header{margin-left:calc(10vmin * 0.2)}@media all and (orientation: landscape){.navbar h1 #small-header{display:none}}.navbar h1 #version{margin-left:10px;color:#737379}@media all and (orientation: portrait){.navbar h1 #version{display:none}}.navbar #old-version{color:#dbdbdd;background-color:transparent;margin-right:10px}@media all and (orientation: portrait){.navbar #old-version{display:none}}.navbar .social{display:flex;align-items:center;margin-right:calc(10vmin * 0.2);margin-left:calc(10vmin * 0.2)}.navbar .social a{color:#dbdbdd;background-color:transparent;text-decoration:none;margin-right:10px}.navbar .social a i{font-size:2em}.navbar .social #donate{border:solid 1px;border-radius:7px;padding:7px 20px 7px 20px;margin-right:30px;align-items:center;justify-content:center;display:flex}.navbar .social #donate span{font-size:1.3em;margin-left:10px}@media all and (orientation: portrait){.navbar .social #donate span{display:none}}.navbar .social a:hover{color:white}.content{display:flex}.content #board-container{margin-top:calc(10vmin * 0.2)}@media all and (orientation: portrait){.content{flex-direction:column;align-items:center}}.toolbar{display:flex;justify-content:space-between}@media all and (orientation: landscape){.toolbar{flex-direction:column;padding-top:calc(10vmin * 0.2)}.toolbar .btn{margin-right:calc(10vmin * 0.2);margin-left:calc(10vmin * 0.2)}}@media all and (orientation: portrait){.toolbar{width:calc(10vmin * 8.8);padding-top:calc(10vmin * 0.2)}}.btn{width:10vmin;height:10vmin;outline:none;color:white;background-color:#7a869c;border:none;text-decoration:none;text-align:center}.btn i{font-size:calc(10vmin * 0.3)}@media (max-height: 800px), (orientation: portrait){.btn i{font-size:calc(10vmin * 0.4)}}.btn div{margin-top:10px;font-size:calc(10vmin * 0.13)}@media (max-height: 800px), (orientation: portrait){.btn div{display:none}}.btn:hover{transition:all 0.5s;background-color:#545e71}.btn:active{transition:all 0.5s;transition:background-color 0s;box-shadow:0 0 2px 2px #657188}.select{background-color:#3a404d}.ajs-message{background-color:#657188;color:white}.ajs-button{outline:none;color:white;background-color:#657188;border:none;text-decoration:none;text-align:center}.ajs-button:hover{transition:all 0.5s;background-color:#545e71}.ajs-button:active{transition:all 0.5s;transition:background-color 0s;box-shadow:0 0 2px 2px #657188}\n',""]),e.exports=t}});