{"version":3,"sources":["board.js","main.js","panel.js"],"names":["board","boardSelector","piecesPanelSelector","chess","Chess","reset","chessBoard","$","piecesPanel","w","window","innerWidth","h","innerHeight","height","primaryColor","cellSize","Math","floor","min","pagePadding","borderSize","gameFieldSize","boardSize","width","gameFieldClass","gameField","cells","i","SQUARES","length","square","color","square_color","piece","get","cell","append","addClass","type","css","push","alphabetLetterPanel","letters","alphabetLetter","numericLetterPanel","numericLetter","clone","figureColors","chessFigureList","piecesField","panelCells","figureLine","j","createCell","lastClickedCell","img","deselectLastClickedCell","removeClass","resetDrawMode","firstArrowPoint","drawMode","arrowDrawMode","arrowsDrawer","$cArrows","on","e","stopPropagation","this","parents","arrowPoint","attr","arrow","connectionType","render","strokeStyle","lineWidth","clickedCell","is","empty","children","prependTo","detach","drake","dragula","concat","revertOnSpill","removeOnSpill","accepts","el","target","source","sibling","setTimeout","copy","renderPieces","updateButtonPanel","rotatePiecesPanel","mainPanelWidth","hasClass","outerWidth","outerHeight","delId","putId","putType","putColor","remove","put","move","not","resize","document","ready","x","clear","alert","fen","position","load","prompt","setPosition","createArrow","clearArrowLayout","CanvasStorage","redraw","sizePx","click","setPositionFromUser","getPosition","initial","ev","html2canvas","onrendered","canvas","ctx","getContext","globalAlpha","textAlign","fontSize","font","shadowColor","shadowBlur","textBaseline","scale","fillStyle","fillText","body","appendChild","a","createElement","dt","toDataURL","replace","removeChild","download","href","savedPositions","1-1","1-2","1-3","1-4","1-5","1-6","1-7","2-1","2-2","2-3","2-4","2-5","2-6","setSavedPosition","id","jQuery","$bodyEl","$sidedrawerEl","options","onclose","appendTo","$overlayEl","mui","overlay","toggleClass","$titleEls","next","hide","show"],"mappings":"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","file":"app.js","sourcesContent":["function board(boardSelector, piecesPanelSelector) {\r\n    var chess = new Chess();\r\n    chess.reset();\r\n    var chessBoard = $(boardSelector);\r\n    var piecesPanel = $(piecesPanelSelector);\r\n\r\n    var w = window.innerWidth;\r\n    var h = window.innerHeight - $('#header').height();\r\n\r\n    var pagePadding = 20;\r\n    var primaryColor = '#9C6C49';\r\n    var arrowColor = '#43362D';\r\n    var borderProportion = 0.3;\r\n    var letterFontProportion = 0.2;\r\n    var cellCount = 8;\r\n    var cellSize = Math.floor(((Math.min(w, h) - pagePadding * 2) / (cellCount + borderProportion * 2)));\r\n    var borderSize = cellSize * borderProportion;\r\n    var gameFieldSize = cellSize * cellCount + 4; //2 px for border\r\n    var boardSize = gameFieldSize + borderSize * 2;\r\n    chessBoard.width(boardSize).height(boardSize);\r\n\r\n    var gameFieldClass = 'gameField';\r\n    var gameField = $('<div class=\"' + gameFieldClass + '\"/>').height(gameFieldSize).width(gameFieldSize);\r\n\r\n    var cells = [];\r\n    for (var i = 0; i < chess.SQUARES.length; i++) {\r\n        var square = chess.SQUARES[i];\r\n        var color = chess.square_color(square);\r\n        var piece = chess.get(square);\r\n        var cell = $('<div id=\"' + square + '\" class=\"cell\"></div>')\r\n            .width(cellSize)\r\n            .height(cellSize);\r\n\r\n        gameField.append(cell.addClass(color));\r\n        if (piece) {\r\n            cell.append($('<div data-type=\"' + piece.type + '\" data-color=\"' + piece.color + '\" class=\"piece\"></div>') //id=\"' + square + '\"\r\n                .width(cellSize)\r\n                .height(cellSize)\r\n                .css('background-image', 'url(img/pieces/' + piece.type + piece.color + '.svg)'));\r\n        }\r\n        cells.push(cell[0]);\r\n    }\r\n\r\n    var alphabetLetterPanel = $('<div>').css('margin-left', borderSize + 'px');\r\n    var letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];\r\n    for (var i = 0; i < 8; i++) {\r\n        var alphabetLetter = $('<div class=\"alphabetLetter\">' + letters[i] + '</div>')\r\n            .width(cellSize)\r\n            .height(borderSize)\r\n            .css('line-height', borderSize + 'px')\r\n            .css('font-size', cellSize * letterFontProportion + 'px');\r\n        alphabetLetterPanel.append(alphabetLetter);\r\n    }\r\n\r\n    var numericLetterPanel = $('<div class=\"numericLetterPanel\"/>').width(borderSize);\r\n    for (var i = 8; i > 0; i--) {\r\n        var numericLetter = $('<div class=\"numericLetter\">' + i + '</div>')\r\n            .css('line-height', cellSize + 'px')\r\n            .css('font-size', cellSize * letterFontProportion + 'px');\r\n        numericLetterPanel.append(numericLetter);\r\n    }\r\n\r\n    chessBoard.append(alphabetLetterPanel);\r\n    chessBoard.append(\r\n        $('<div/>')\r\n            .append(numericLetterPanel)\r\n            .append(gameField)\r\n            .append(numericLetterPanel.clone()));\r\n    chessBoard.append(alphabetLetterPanel.clone());\r\n\r\n    var figureColors = ['b', 'w']; // black, white\r\n    var chessFigureList = ['r', 'n', 'b', 'k', 'q', 'p'];\r\n    var piecesField = $('<div/>');\r\n\r\n    var panelCells = [];\r\n    for (var i = 0; i < figureColors.length; i++) {\r\n        var figureLine = $('<div class=\"pieces-panel-row\"/>');\r\n        for (var j = 0; j < chessFigureList.length; j++) {\r\n            var cell = createCell('url(img/pieces/' + chessFigureList[j] + figureColors[i] + '.svg)', chessFigureList[j], figureColors[i]);\r\n            figureLine.append(cell);\r\n            panelCells.push(cell[0]);\r\n        }\r\n\r\n        //add custom icon\r\n        if (i == 0) {\r\n            var cell = createCell('url(img/pieces/custom/candy.svg)');\r\n            figureLine.append(cell);\r\n            panelCells.push(cell[0]);\r\n\r\n            cell = createCell('url(img/pieces/custom/ice-cream.svg)');\r\n            figureLine.append(cell);\r\n            panelCells.push(cell[0]);\r\n        } else {\r\n            var cell = createCell('url(img/pieces/custom/bomb.svg)');\r\n            figureLine.append(cell);\r\n            panelCells.push(cell[0]);\r\n\r\n            cell = createCell('url(img/pieces/custom/crocodile.svg)');\r\n            figureLine.append(cell);\r\n            panelCells.push(cell[0]);\r\n        }\r\n\r\n        piecesField.append(figureLine);\r\n    }\r\n    piecesField.append('<div class=\"clearfix\"/>');\r\n\r\n    piecesPanel.append(piecesField).css('padding', borderSize + 'px');\r\n\r\n    var lastClickedCell = null;\r\n\r\n    function createCell(img, type, color) {\r\n        var cell = $('<div class=\"cell\"></div>')\r\n            .width(cellSize)\r\n            .height(cellSize);\r\n        cell.append($('<div data-type=\"' + piece.type + '\" data-color=\"' + piece.color + '\" class=\"piece\"/>')\r\n            .width(cellSize)\r\n            .height(cellSize)\r\n            .css('background-image', img));\r\n\r\n        return cell;\r\n    }\r\n\r\n    function deselectLastClickedCell() {\r\n        if (lastClickedCell) {\r\n            lastClickedCell.removeClass('clicked');\r\n        }\r\n        lastClickedCell = null;\r\n    }\r\n\r\n    function setDrawMode() {\r\n        drawMode = arrowDrawMode;\r\n        $('#arrow-btn').css('background-color', 'white');\r\n        $('#arrow-btn').css('box-shadow', 'inset 0 0 0 ' + cellSize / 10 + 'px ' + primaryColor);\r\n        $('#arrow-btn').css('color', primaryColor);\r\n        $('.' + gameFieldClass + ' .cell, .' + gameFieldClass + ' .piece').addClass('cursor-pointer');\r\n    }\r\n\r\n    function resetDrawMode() {\r\n        drawMode = null;\r\n        firstArrowPoint = null;\r\n        $('#arrow-btn').css('background-color', \"\");\r\n        $('#arrow-btn').css('box-shadow', 'none');\r\n        $('#arrow-btn').css('color', 'white');\r\n        $('.' + gameFieldClass + ' .cell, .' + gameFieldClass + ' .piece').removeClass('cursor-pointer');\r\n    }\r\n\r\n    var drawMode = null;\r\n    var arrowDrawMode = 'ARROW_DRAW_MODE';\r\n    var arrowsDrawer = $cArrows('.' + gameFieldClass);\r\n    var firstArrowPoint = null;\r\n\r\n    $('.cell').on('click', function (e) {\r\n        e.stopPropagation();\r\n        //if draw mode is arrow\r\n        if (drawMode == arrowDrawMode) {\r\n            if ($(this).parents('.' + gameFieldClass).length > 0) {\r\n                if (firstArrowPoint) {\r\n                    var arrowPoint = $(this).attr('id');\r\n                    if (firstArrowPoint != arrowPoint) {\r\n\r\n                        arrowsDrawer.arrow('#' + firstArrowPoint, '#' + $(this).attr('id'), {\r\n                            arrow: {\r\n                                connectionType: 'center',\r\n                            },\r\n                            render: {\r\n                                strokeStyle: 'white',\r\n                                lineWidth: cellSize / 7\r\n                            }\r\n                        });\r\n\r\n                        arrowsDrawer.arrow('#' + firstArrowPoint, '#' + $(this).attr('id'), {\r\n                            arrow: {\r\n                                connectionType: 'center',\r\n                            },\r\n                            render: {\r\n                                strokeStyle: arrowColor,\r\n                                lineWidth: cellSize / 8\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    firstArrowPoint = null;\r\n                } else {\r\n                    firstArrowPoint = $(this).attr('id');\r\n                }\r\n            } else {\r\n                resetDrawMode();\r\n            }\r\n        } else {\r\n            var clickedCell = $(this);\r\n            // add to new cell if figure was clicked\r\n            if (lastClickedCell) {\r\n                if (clickedCell.parents('#pieces-panel').length == 0) {\r\n                    if (!lastClickedCell.is(clickedCell)) {\r\n                        clickedCell.empty();\r\n                    }\r\n\r\n                    if (lastClickedCell.parents('#pieces-panel').length > 0) {\r\n                        $(lastClickedCell.children()[0]).clone().prependTo(clickedCell);\r\n                    } else {\r\n                        $(lastClickedCell.children()[0]).detach().prependTo(clickedCell);\r\n                    }\r\n                    //del if has selected figure and we clicked on panel\r\n                } else if (lastClickedCell.parents('#pieces-panel').length == 0) {\r\n                    lastClickedCell.empty();\r\n                }\r\n\r\n                if (lastClickedCell.parents('#pieces-panel').length == 0 || clickedCell.parents('.gameField').length == 0) {\r\n                    deselectLastClickedCell();\r\n                }\r\n            } else if (clickedCell.children().length > 0) {\r\n                lastClickedCell = clickedCell;\r\n                clickedCell.addClass('clicked');\r\n            }\r\n        }\r\n    });\r\n\r\n    $(window).on('click', function (e) {\r\n        if (lastClickedCell) {\r\n            // do not delete if figure on pieces panel\r\n            if (lastClickedCell.parents('#pieces-panel').length == 0) {\r\n                lastClickedCell.empty();\r\n            }\r\n\r\n            deselectLastClickedCell();\r\n        }\r\n        resetDrawMode();\r\n    });\r\n\r\n    function move(delId, putType, putColor, putId) {\r\n        chess.remove(delId);\r\n        chess.put({type: putType, color: putColor}, putId)\r\n    }\r\n\r\n    var drake = dragula(cells.concat(panelCells), {\r\n        revertOnSpill: true,\r\n        removeOnSpill: true,\r\n        accepts: function (el, target, source, sibling) {\r\n            if ($(target).parents('#pieces-panel').length > 0) {\r\n                return false;\r\n            }\r\n\r\n            setTimeout(function () {\r\n                $('.gu-transit', target).prependTo(target);\r\n            });\r\n\r\n            return true; // elements can be dropped in any of the `containers` by default\r\n        },\r\n        copy: function (el) {\r\n            if ($(el).parents('#pieces-panel').length > 0) {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    });\r\n\r\n    drake.on('drag', function (el, source) {\r\n        resetDrawMode();\r\n        if (lastClickedCell) {\r\n            deselectLastClickedCell();\r\n        }\r\n    });\r\n\r\n    drake.on('drop', function (el, target, source, sibling) {\r\n        var delId = $(target).attr('id');\r\n        var putId = $(source).attr('id');\r\n        var putType = $(el).attr('data-type');\r\n        var putColor = $(el).attr('data-color');\r\n\r\n        move(delId, putType, putColor, putId);\r\n\r\n        $(target).children().not(\":first\").remove();\r\n    });\r\n\r\n    function renderPieces() {\r\n        for (var i = 0; i < chess.SQUARES.length; i++) {\r\n            var square = chess.SQUARES[i];\r\n            var piece = chess.get(square);\r\n            if (piece) {\r\n                var cell = $('#' + square);\r\n                cell.append($('<div data-type=\"' + piece.type + '\" data-color=\"' + piece.color + '\" id=\"' + square + '\" class=\"piece\"></div>')\r\n                    .width(cellSize)\r\n                    .height(cellSize)\r\n                    .css('background-image', 'url(img/pieces/' + piece.type + piece.color + '.svg)'));\r\n            }\r\n        }\r\n    }\r\n\r\n    $(window).resize(function () {\r\n        rotatePiecesPanel();\r\n        updateButtonPanel();\r\n    });\r\n\r\n    $(document).ready(function () {\r\n        rotatePiecesPanel();\r\n        updateButtonPanel();\r\n    });\r\n\r\n    function updateButtonPanel() {\r\n        $('.btn-main')\r\n            .height(cellSize)\r\n            .width(cellSize)\r\n            .css('font-size', (cellSize / 2))\r\n            .css('line-height', cellSize + 'px')\r\n    }\r\n\r\n    function rotatePiecesPanel() {\r\n        var mainPanelWidth = $('body').hasClass('hide-sidedrawer') ? 0 : $('#sidedrawer').width();\r\n\r\n        if (($(window).width() - mainPanelWidth - $('#board-container').outerWidth(true)) -\r\n            Math.min($('#pieces-panel').outerWidth(true), $('#pieces-panel').outerHeight(true)) > 0) {\r\n            $('#pieces-panel .cell').css('float', 'none');\r\n            $('#pieces-panel .pieces-panel-row').css('float', 'left');\r\n        } else {\r\n            $('#pieces-panel .cell').css('float', 'left');\r\n            $('#pieces-panel .pieces-panel-row').css('float', 'none');\r\n        }\r\n    }\r\n\r\n    var x = {};\r\n    x.clear = function () {\r\n        chess.clear();\r\n        $('.piece', boardSelector).remove();\r\n    }\r\n\r\n    x.initial = function () {\r\n        x.clear();\r\n        chess.reset();\r\n        renderPieces();\r\n    };\r\n\r\n    x.getPosition = function () {\r\n        alert(chess.fen());\r\n    };\r\n\r\n    x.setPosition = function (position) {\r\n        x.clear();\r\n        chess.reset();\r\n        chess.load(position);\r\n        renderPieces();\r\n    };\r\n\r\n    x.setPositionFromUser = function () {\r\n        var position = prompt('Введите позиции в формате FEN', 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');\r\n\r\n        //if click cancel\r\n        if (!position) {\r\n            return;\r\n        }\r\n\r\n        x.setPosition(position)\r\n\r\n        //todo validate?\r\n        //https://github.com/jhlywa/chess.js/#validate_fenfen\r\n        // if (chess.validate_fen(position).valid) {\r\n        //     x.setPosition(position)\r\n        // } else {\r\n        //     alert('Введенная позиция неверна!')\r\n        // }\r\n    };\r\n\r\n    x.createArrow = function (e) {\r\n        deselectLastClickedCell();\r\n        setDrawMode();\r\n        e.stopPropagation();\r\n    };\r\n\r\n    x.clearArrowLayout = function () {\r\n        arrowsDrawer.CanvasStorage[2] = [];\r\n        arrowsDrawer.redraw();\r\n    };\r\n\r\n    x.sizePx = boardSize;\r\n\r\n    return x;\r\n}\r\n","var board = board('#board-container', '#pieces-panel');\r\n\r\n$('#load-fen-btn-header').click(board.setPositionFromUser);\r\n\r\n$('#save-fen-btn-header').click(board.getPosition);\r\n\r\n$('#clear-btn, #clear-btn-header').click(board.clear);\r\n\r\n$('#initial-btn, #initial-btn-header').click(board.initial);\r\n\r\n$('#arrow-btn, #arrow-btn-header').click(board.createArrow);\r\n\r\n$('#arrows-delete-btn, #arrows-delete-btn-header').click(board.clearArrowLayout);\r\n\r\n$('#download-image-btn, #download-image-btn-header').click((ev) => {\r\n    html2canvas($(\"#board-container\"), {\r\n        onrendered: function (canvas) {\r\n            // canvas\r\n            var ctx = canvas.getContext(\"2d\");\r\n            ctx.globalAlpha = 0.2;\r\n            ctx.textAlign = \"center\";\r\n            var fontSize = board.sizePx / 8;\r\n            ctx.font = fontSize + \"px Arial\";\r\n            \r\n            ctx.shadowColor = \"black\";\r\n            ctx.shadowBlur = 1;\r\n            ctx.textBaseline = 'alphabetic';\r\n            ctx.scale(1, 1);\r\n            ctx.fillStyle = \"white\";\r\n\r\n            ctx.fillText(\"chess-board.ru\", canvas.width / 2, canvas.height / 2 + fontSize / 4);\r\n            document.body.appendChild(canvas);\r\n            var a = document.createElement('a');\r\n            var dt = canvas.toDataURL('image/png');\r\n            dt = dt.replace('image/png', 'image/octet-stream');\r\n            document.body.removeChild(canvas);\r\n            a.download = 'board.png';\r\n            a.href = dt;\r\n            a.click();\r\n        },\r\n        width: board.sizePx,\r\n        height: board.sizePx\r\n    });\r\n});\r\n\r\nvar savedPositions = {\r\n    '1-1': '3k4/3p4/8/3KB3/8/p7/P7/5b2 w KQkq - 0 1',\r\n    '1-2': '8/6k1/6p1/3K4/5B2/8/8/8 w KQkq - 0 1',\r\n    '1-3': '2r5/8/2p1k3/2P5/8/5B2/5K2/8 w KQkq - 0 1',\r\n    '1-4': '7k/8/1p6/1P6/1Q1K4/8/8/8 w KQkq - 0 1',\r\n    '1-5': '2r4k/8/5p2/5P2/6K1/8/1Q5P/8 w KQkq - 0 1',\r\n    '1-6': '8/3b1k2/3p4/8/2N5/2P5/2K5/8 w KQkq - 0 1',\r\n    '1-7': '8/8/2pk4/8/2PP4/3K4/8/8 w KQkq - 0 1',\r\n\r\n    '2-1': '6k1/8/3R2K1/8/8/8/8/8 w KQkq - 0 1',\r\n    '2-2': '7k/8/6K1/8/8/8/5R2/8 w KQkq - 0 1',\r\n    '2-3': '8/8/8/5K2/7k/8/8/3Q4 w KQkq - 0 1',\r\n    '2-4': '8/6Q1/8/8/2K5/8/k7/2B5 w KQkq - 0 1',\r\n    '2-5': '1Q6/8/8/7N/2K5/7k/8/8 w KQkq - 0 1',\r\n    '2-6': '7k/2p2R2/3p4/3K4/8/1p6/1P6/1Q6 w KQkq - 0 1',\r\n}\r\n\r\nfunction setSavedPosition(id) {\r\n    board.setPosition(savedPositions[id]);\r\n}","jQuery(function ($) {\r\n    var $bodyEl = $('body'),\r\n        $sidedrawerEl = $('#sidedrawer');\r\n\r\n\r\n    // ==========================================================================\r\n    // Toggle Sidedrawer\r\n    // ==========================================================================\r\n    function showSidedrawer() {\r\n        // show overlay\r\n        var options = {\r\n            onclose: function () {\r\n                $sidedrawerEl\r\n                    .removeClass('active')\r\n                    .appendTo(document.body);\r\n            }\r\n        };\r\n\r\n        var $overlayEl = $(mui.overlay('on', options));\r\n\r\n        // show element\r\n        $sidedrawerEl.appendTo($overlayEl);\r\n        setTimeout(function () {\r\n            $sidedrawerEl.addClass('active');\r\n        }, 20);\r\n    }\r\n\r\n\r\n    function hideSidedrawer() {\r\n        $bodyEl.toggleClass('hide-sidedrawer');\r\n    }\r\n\r\n\r\n    $('.js-show-sidedrawer').on('click', showSidedrawer);\r\n    $('.js-hide-sidedrawer').on('click', hideSidedrawer);\r\n\r\n\r\n    // ==========================================================================\r\n    // Animate menu\r\n    // ==========================================================================\r\n    var $titleEls = $('strong', $sidedrawerEl);\r\n\r\n    $titleEls\r\n        .next()\r\n        .hide();\r\n\r\n    $titleEls.on('click', function () {\r\n        var el = $(this).next();\r\n        if (el.is(\":visible\")) {\r\n            el.hide();\r\n        } else {\r\n            el.show();\r\n        }\r\n    });\r\n});\r\n"]}